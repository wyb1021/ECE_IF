/*[하드웨어 설명서]
다른 아두이노와 함께 0,1핀으로 연결, gnd 연결
>LCD
SDA: A4
SCL:A5
>토글 버튼: A3
>RF통신
MISO: 12
SCK: 13
MOSI: 11
CE: 7
CSN: 8 
VCC: 3.3V
>OLED
SCL: A5
SDA: A4   
*/
//무게를 무게 차로 계산
  //<Ultrasonic>
  //1번
  #include <Adafruit_GFX.h>
  #include <Adafruit_GrayOLED.h>
  #include <Adafruit_SPITFT.h>
  #include <Adafruit_SPITFT_Macros.h>
  #include <gfxfont.h>
  #include <Adafruit_GFX.h>
  #include <Adafruit_SSD1306.h>

  #define SCREEN_WIDTH 128
  #define SCREEN_HEIGHT 64
  #define OLED_RESET    -1 // 리셋 핀이 없는 경우 -1 사용
  
  #include <SPI.h>
  #include <HX711.h>
  #include "HX711.h" // HX711로드셀 앰프 관련함수 호출

  #include <SPI.h>
  #include <nRF24L01.h>
  #include <RF24.h>
  RF24 radio(7, 8);
  const byte address[6] = "01001"; // 주소값을 부여합니다. 송신기와 수신기를 동일한 주소로 입력 해야합니다.

  #define calibration_factor -7050.0 // 로드셀 스케일 값 선언
  #define DOUT A0 // 앰프 데이터 아웃 핀 넘버 선언
  #define CLK A1 // 앰프 클락 핀 넘버
  HX711 scale(DOUT, CLK); // 앰프 핀 선언

  float newweight=0;
  float weight=0;
  float difweight=0;
  float threshold=0.6;

  int piezo=5;
  int green=2;
  int yellow=3;
  int red=4;

  Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

// 'CART_drive', 128x64px
const unsigned char epd_bitmap_CART_drive [] PROGMEM = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xc0, 0x68, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x70, 0xcc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x1f, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x01, 0x80, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x03, 0x03, 0xff, 0x80, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x06, 0x1e, 0x00, 0xe0, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x0c, 0x30, 0x00, 0x30, 0x68, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x18, 0x60, 0x00, 0x18, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x30, 0xc0, 0x00, 0x0c, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x20, 0x98, 0x00, 0x64, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x61, 0x8c, 0x38, 0xc6, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x43, 0x06, 0xed, 0x82, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x42, 0x1d, 0x86, 0xe3, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x42, 0x31, 0x02, 0x31, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x42, 0x01, 0xe2, 0x01, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x42, 0x70, 0x92, 0x71, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x42, 0x38, 0xa6, 0x39, 0x04, 0x00, 0x00, 0x00, 0x01, 0xf8, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x42, 0x01, 0xc4, 0x03, 0x04, 0x00, 0x00, 0x00, 0x0f, 0x0f, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x43, 0x01, 0x0c, 0x02, 0x04, 0x00, 0x00, 0x00, 0x38, 0x01, 0xc0, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x41, 0x01, 0xf8, 0x06, 0x04, 0x00, 0x00, 0x00, 0x60, 0x00, 0x60, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x61, 0x80, 0x00, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x40, 0x00, 0x20, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x20, 0xc0, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0xcf, 0xf8, 0x30, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x30, 0x60, 0x00, 0x30, 0x30, 0x00, 0x00, 0x00, 0x98, 0x1e, 0x10, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x18, 0x30, 0x00, 0x60, 0x61, 0xc0, 0x00, 0x00, 0x90, 0x03, 0x10, 0x00, 0x00, 
   0x00, 0x00, 0x03, 0x88, 0x1c, 0x01, 0xc0, 0x67, 0x40, 0x00, 0x00, 0x90, 0x03, 0x10, 0x00, 0x00, 
   0x00, 0x00, 0x02, 0xcc, 0x07, 0xff, 0x00, 0xdc, 0x40, 0x00, 0x00, 0x93, 0x81, 0x18, 0x00, 0x00, 
   0x00, 0x00, 0x02, 0x64, 0x00, 0x00, 0x00, 0xf0, 0x40, 0x00, 0x00, 0x9c, 0xc1, 0x08, 0x00, 0x00, 
   0x00, 0x00, 0x02, 0x3e, 0x00, 0x00, 0x01, 0x80, 0xc0, 0x00, 0x00, 0xc6, 0x41, 0x08, 0x00, 0x00, 
   0x00, 0x00, 0x03, 0x02, 0x00, 0x00, 0x01, 0x01, 0x80, 0x00, 0x00, 0x7a, 0x41, 0x08, 0x00, 0x00, 
   0x00, 0x00, 0x01, 0x82, 0x21, 0x04, 0x71, 0x03, 0x00, 0x00, 0x00, 0x00, 0xc1, 0x18, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xc3, 0x73, 0xce, 0xdb, 0x06, 0x00, 0x1f, 0xff, 0xff, 0x81, 0x10, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x61, 0xde, 0x7b, 0x8e, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x03, 0x10, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x02, 0x10, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x30, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x0c, 0x05, 0x9e, 0x78, 0x04, 0x00, 0x1f, 0xff, 0xff, 0xf8, 0x20, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x06, 0x05, 0x96, 0x60, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x03, 0x05, 0x96, 0x78, 0x06, 0x00, 0x00, 0x00, 0x00, 0x03, 0x80, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x01, 0x05, 0x96, 0x18, 0x03, 0x80, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x01, 0x85, 0x96, 0x18, 0x00, 0xc0, 0x1f, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x87, 0x96, 0x78, 0x7f, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0xc7, 0x9e, 0x79, 0xe0, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x03, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x02, 0x7f, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x02, 0xc1, 0x90, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x06, 0x9e, 0xd0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x03, 0x80, 0x04, 0xc2, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x04, 0x7c, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x06, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// 'CART_in - 복사본 - 복사본', 128x64px
const unsigned char epd_bitmap_CART_in [] PROGMEM = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x01, 0xff, 0xe0, 0x34, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x07, 0x00, 0x38, 0x66, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x0f, 0xc2, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x7f, 0xfc, 0x00, 0x00, 0x01, 0x81, 0xff, 0xc0, 0x02, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x3f, 0xf8, 0x00, 0x00, 0x03, 0x0f, 0x00, 0x70, 0x06, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x1f, 0xf0, 0x00, 0x00, 0x06, 0x18, 0x00, 0x18, 0x34, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x0c, 0x30, 0x00, 0x0c, 0x1c, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x18, 0x60, 0x00, 0x06, 0x18, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x03, 0x80, 0x00, 0x00, 0x10, 0x40, 0x00, 0x02, 0x0c, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x30, 0xc6, 0x3c, 0x63, 0x04, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x30, 0x00, 0x21, 0x86, 0x66, 0x61, 0x06, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0xfc, 0x00, 0x21, 0x06, 0xc3, 0x61, 0x82, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xe7, 0x80, 0x03, 0xce, 0x00, 0x21, 0x00, 0x81, 0x00, 0x82, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x01, 0xc0, 0xe0, 0x0e, 0x07, 0x00, 0x21, 0x38, 0xbd, 0x38, 0x82, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x01, 0x80, 0x30, 0x18, 0x03, 0x00, 0x21, 0x1c, 0xa5, 0x1c, 0x82, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xc0, 0x18, 0x30, 0x06, 0x00, 0x21, 0x00, 0xbd, 0x00, 0x82, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xe0, 0x1c, 0x70, 0x0e, 0x00, 0x21, 0x00, 0x99, 0x01, 0x82, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x70, 0x0e, 0xe0, 0x1c, 0x00, 0x21, 0x80, 0x42, 0x01, 0x02, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x38, 0x07, 0xc0, 0x38, 0x00, 0x20, 0x80, 0x3c, 0x03, 0x04, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x1e, 0x03, 0x80, 0xf0, 0x00, 0x30, 0xc0, 0x00, 0x06, 0x04, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x10, 0x60, 0x00, 0x0c, 0x0c, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x18, 0x30, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0c, 0x00, 0x07, 0xc0, 0x00, 0x60, 0x0c, 0x18, 0x00, 0x30, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0c, 0x00, 0x07, 0xc0, 0x00, 0x61, 0xc4, 0x0e, 0x00, 0xe0, 0x30, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0c, 0x00, 0x07, 0xc0, 0x00, 0x61, 0x66, 0x03, 0xff, 0x80, 0x20, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xe1, 0x32, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xc1, 0x1e, 0x00, 0x01, 0xe0, 0x60, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x03, 0x00, 0x03, 0x80, 0x01, 0x81, 0x87, 0x00, 0x01, 0x38, 0x60, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x03, 0x00, 0x03, 0x80, 0x01, 0x80, 0xc3, 0x10, 0x83, 0x0c, 0x40, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x03, 0x80, 0x03, 0x80, 0x03, 0x80, 0x61, 0xb9, 0xe7, 0x86, 0x40, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x03, 0x80, 0x03, 0x80, 0x03, 0x80, 0x30, 0xef, 0x3d, 0xc3, 0x40, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x01, 0x80, 0x03, 0x80, 0x03, 0x00, 0x18, 0x00, 0x00, 0x61, 0xc0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xc0, 0x03, 0x80, 0x06, 0x00, 0x08, 0x00, 0x00, 0x30, 0xc0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xc0, 0x03, 0x80, 0x06, 0x00, 0x08, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xe0, 0x03, 0x80, 0x0e, 0x00, 0x08, 0x4c, 0xf9, 0xf0, 0x80, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xe0, 0x03, 0x80, 0x0e, 0x00, 0x0c, 0x4c, 0x99, 0x00, 0x80, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x60, 0x03, 0x80, 0x0c, 0x00, 0x04, 0x4c, 0x99, 0xf1, 0x80, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x60, 0x03, 0x80, 0x0c, 0x00, 0x04, 0x4c, 0x98, 0x31, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x70, 0x03, 0x80, 0x1c, 0x00, 0x06, 0x4c, 0x99, 0xf1, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x30, 0x03, 0x80, 0x18, 0x00, 0x02, 0x7c, 0xf9, 0xf1, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x30, 0x03, 0x80, 0x18, 0x00, 0x02, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x18, 0x03, 0x80, 0x30, 0x00, 0x03, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xf0, 0x00, 0x01, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0xfc, 0x06, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc1, 0x86, 0x0c, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x03, 0xf8, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc1, 0x86, 0x0c, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x84, 0x04, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x03, 0xf8, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// 'CART_stop - 복사본', 128x64px
const unsigned char epd_bitmap_CART_stop [] PROGMEM = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x1f, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x0f, 0xff, 0x01, 0xa0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x7f, 0xf0, 0x0f, 0xfe, 0x00, 0x00, 0x38, 0x01, 0xc3, 0x30, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xff, 0x80, 0x01, 0xff, 0x00, 0x00, 0xe0, 0x00, 0x7e, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x01, 0xfe, 0x00, 0x00, 0x7f, 0x80, 0x03, 0x80, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x3f, 0x80, 0x06, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x0f, 0xc0, 0x0c, 0x0f, 0xfe, 0x00, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x07, 0xf0, 0x00, 0x00, 0x07, 0xe0, 0x18, 0x78, 0x03, 0x80, 0x30, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x07, 0xe0, 0x00, 0x00, 0x07, 0xe0, 0x30, 0xc0, 0x00, 0xc1, 0xa0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0f, 0xc0, 0x00, 0x00, 0x03, 0xf0, 0x61, 0x80, 0x00, 0x60, 0xe0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0f, 0x80, 0x00, 0x00, 0x01, 0xf0, 0xc3, 0x00, 0x00, 0x30, 0xc0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x1f, 0x80, 0x00, 0x00, 0x01, 0xf8, 0x82, 0x00, 0x00, 0x10, 0x60, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x00, 0xf9, 0x86, 0x31, 0xe3, 0x18, 0x20, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x1f, 0x1f, 0xbf, 0x7e, 0xfc, 0xf9, 0x0c, 0x33, 0x33, 0x08, 0x30, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x3f, 0x1f, 0xbf, 0x7e, 0xfc, 0xfd, 0x08, 0x36, 0x1b, 0x0c, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x3e, 0x18, 0x0c, 0x66, 0xcc, 0x7d, 0x08, 0x04, 0x08, 0x04, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x3e, 0x18, 0x0c, 0x66, 0xcc, 0x7d, 0x09, 0xc5, 0xe9, 0xc4, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x3e, 0x1f, 0x8c, 0x66, 0xfc, 0x7d, 0x08, 0xe5, 0x28, 0xe4, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x3e, 0x1f, 0x8c, 0x66, 0xfc, 0x7d, 0x08, 0x05, 0xe8, 0x04, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x3e, 0x01, 0x8c, 0x66, 0xc0, 0x7d, 0x08, 0x04, 0xc8, 0x0c, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x3e, 0x01, 0x8c, 0x66, 0xc0, 0x7d, 0x0c, 0x02, 0x10, 0x08, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x3e, 0x1f, 0x8c, 0x7e, 0xc0, 0x7d, 0x04, 0x01, 0xe0, 0x18, 0x20, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x3f, 0x1f, 0x8c, 0x7e, 0xc0, 0xfd, 0x86, 0x00, 0x00, 0x30, 0x20, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x83, 0x00, 0x00, 0x60, 0x60, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xc1, 0x80, 0x00, 0xc0, 0xc0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x1f, 0x80, 0x00, 0x00, 0x01, 0xf8, 0x60, 0xc0, 0x01, 0x81, 0x80, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0f, 0x80, 0x00, 0x00, 0x01, 0xfe, 0x20, 0x70, 0x07, 0x01, 0x80, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x0f, 0xc0, 0x00, 0x00, 0x03, 0xfb, 0x30, 0x1f, 0xfc, 0x03, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x07, 0xe0, 0x00, 0x00, 0x03, 0xe9, 0x90, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x07, 0xe0, 0x00, 0x00, 0x07, 0xe8, 0xf8, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x03, 0xf0, 0x00, 0x00, 0x0f, 0xcc, 0x08, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x3f, 0x86, 0x08, 0x84, 0x11, 0xc4, 0x80, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x01, 0xfe, 0x00, 0x00, 0x7f, 0x83, 0x0d, 0xcf, 0x3b, 0x6c, 0xc0, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0xff, 0x80, 0x01, 0xff, 0x01, 0x87, 0x79, 0xee, 0x38, 0x40, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x7f, 0xf0, 0x0f, 0xfe, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xf8, 0x00, 0x40, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xf0, 0x00, 0x40, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xc0, 0x00, 0x42, 0x67, 0xcf, 0x82, 0x18, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x62, 0x64, 0xc8, 0x07, 0x08, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x1f, 0xf8, 0x00, 0x00, 0x22, 0x64, 0xcf, 0x85, 0x88, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x01, 0x40, 0x00, 0x00, 0x22, 0x64, 0xc1, 0x8c, 0xc8, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x01, 0x40, 0x00, 0x00, 0x32, 0x64, 0xcf, 0x88, 0x78, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x01, 0x40, 0x00, 0x00, 0x13, 0xe7, 0xcf, 0x88, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x01, 0x40, 0x00, 0x00, 0x10, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x01, 0x40, 0x00, 0x00, 0x18, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x01, 0x40, 0x00, 0x00, 0x08, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x01, 0x40, 0x00, 0x00, 0x0c, 0x07, 0xe0, 0x30, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x1f, 0xfc, 0x00, 0x00, 0x06, 0x0c, 0x30, 0x60, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x3f, 0xfe, 0x00, 0x00, 0x03, 0xf8, 0x1f, 0xc0, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x7f, 0xff, 0x00, 0x00, 0x06, 0x0c, 0x30, 0x60, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x80, 0x00, 0x04, 0x04, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x80, 0x00, 0x03, 0xf8, 0x1f, 0xc0, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};



void setup() {
  //LED 핀모드 설정
  pinMode(green,OUTPUT);
  pinMode(yellow,OUTPUT);
  pinMode(red,OUTPUT);
  pinMode(piezo,OUTPUT);
  // OLED 초기화
  if(!display.begin(SSD1306_SWITCHCAPVCC, 0x3C)) { 
    Serial.println(("SSD1306 allocation failed"));
    for(;;);
  }
  display.clearDisplay();
  display.display();
  Serial.begin(38400);
  scale.set_scale(calibration_factor); // 스케일 지정
  scale.tare(); // 스케일 설정
  radio.begin();
  radio.openReadingPipe(0, address);
  radio.setPALevel(RF24_PA_HIGH); // 전원공급에 관한 파워레벨을 설정합니다.
  radio.startListening(); // M모듈을 수신기로 설정합니다.
  checkOLED(1);
}

void loop(){  
    init_LED();

    float save;
  if (radio.available()) {
      char text[32] = "";
      radio.read(&text, sizeof(text));
      if(text[0]=='P'){ //바코드 감지
          checkOLED(0);
          Serial.println("s");
          while(1){ 
            checkOLED(0);
            if(checkWeight()>=threshold || getData()){ //무게가 감지되거나 취소되면
              break;
            }
          }
          checkOLED(1);
      } else if(text[0]=='C'){ //취소 버튼
          checkOLED(-1);
          Serial.println("s");
          delay(2000);
          checkOLED(1);
       } else {
        Serial.println(text);//바로 좌표 전송
       }
      }
    }
float checkWeight(){
  float oldweight1 = scale.get_units(); // 무게를 가져옴
 //, 1; // lbs에서 g으로 변환 (1 lbs = 453.592 g)
  float weight1=oldweight1 * 453.592/1000;
  float oldweight2 = scale.get_units(); // 무게를 가져옴
 //, 1; // lbs에서 g으로 변환 (1 lbs = 453.592 g)
  float weight2=oldweight2 * 453.592/1000;
  difweight=weight2-weight1;
  weight1=weight2;
  Serial.println(difweight);
  return difweight;
}
bool getData(){//취소하는 경우
  if (radio.available()) {
      char text[32]="";
      radio.read(&text,sizeof(text));
      if(text[0]=='c'){//취소하면 1
        return true;
      }
  }
  return false;
}
void checkOLED(int num){
  if (num==0){//카트에 담는 중//yellow
    display.clearDisplay();
    display.drawBitmap(0, 0, epd_bitmap_CART_in, 128, 64, WHITE);
    display.display();
    //stop_LED();
  }else if(num==1){//카트가 운행 중//green
    display.clearDisplay();
    display.drawBitmap(0, 0, epd_bitmap_CART_drive, 128, 64, WHITE);
    display.display();
    //go_LED();
  }
  else if(num==-1){//stop
    display.clearDisplay();
    display.drawBitmap(0, 0, epd_bitmap_CART_stop, 128, 64, WHITE);
    display.display();
    //error_LED();
    //init_LED();
  }
}
void go_LED(){
  init_LED();
  digitalWrite(green,HIGH);
  digitalWrite(yellow,LOW);   
  digitalWrite(red,LOW);
}
void stop_LED(){
   // 모든 LED를 초기화한 후 노란색 LED를 켭니다.
  init_LED();
  digitalWrite(green,LOW);
  digitalWrite(yellow,HIGH);   
  digitalWrite(red,LOW);
}
void error_LED(){
   // 모든 LED를 초기화한 후 빨간색 LED를 켭니다.
  init_LED();
  digitalWrite(green,LOW);
  digitalWrite(yellow,LOW);   
  digitalWrite(red,HIGH);
}   
void init_LED(){
  digitalWrite(green,LOW);
  digitalWrite(yellow,LOW);   
  digitalWrite(red,LOW);
}